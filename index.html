

<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>API Reference</title>
    <link href="images/favicon-3b625b57.png" rel="icon" type="image/png" />

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .cd {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .nl {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <link href="stylesheets/screen-90f3b003.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print-a6da9878.css" rel="stylesheet" media="print" />
      <script src="javascripts/all-c5541673.js"></script>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-TRKFS7');</script>
    <!-- End Google Tag Manager -->
  </head>

  <body class="index" data-languages="[&quot;shell&quot;]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar-cad8cdcb.png" alt="Navbar" />
      </span>
    </a>
    <div class="toc-wrapper">
      <img src="images/logo-733a55c3.png" class="logo" alt="Logo" />
        <div class="lang-selector">
              <a href="#" data-language-name="shell">cURL</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <ul id="toc" class="toc-list-h1">
          <li>
              <p class="toc-section">REST API</p>
          </li>
          <li>
              <a href="#getting-started" class="toc-h1 toc-link" data-title="Getting started">Getting started</a>
                <ul class="toc-list-h2">
                    <li>
                      <a href="#overview" class="toc-h2 toc-link" data-title="Overview">Overview</a>
                    </li>
                    <li>
                      <a href="#authentication" class="toc-h2 toc-link" data-title="Authentication">Authentication</a>
                    </li>
                    <li>
                      <a href="#responses" class="toc-h2 toc-link" data-title="Responses">Responses</a>
                    </li>
                </ul>
          </li>
          <li>
              <a href="#contacts" class="toc-h1 toc-link" data-title="Contacts">Contacts</a>
                <ul class="toc-list-h2">
                    <li>
                      <a href="#add-or-update-contact" class="toc-h2 toc-link" data-title="Add or Update Contact">Add or Update Contact</a>
                    </li>
                </ul>
          </li>
          <li>
              <a href="#tags" class="toc-h1 toc-link" data-title="Tags">Tags</a>
                <ul class="toc-list-h2">
                    <li>
                      <a href="#add-tags-to-contact" class="toc-h2 toc-link" data-title="Add Tags to Contact">Add Tags to Contact</a>
                    </li>
                    <li>
                      <a href="#remove-tags-to-contact" class="toc-h2 toc-link" data-title="Remove Tags to Contact">Remove Tags to Contact</a>
                    </li>
                </ul>
          </li>
          <li>
              <a href="#orders" class="toc-h1 toc-link" data-title="Orders">Orders</a>
                <ul class="toc-list-h2">
                    <li>
                      <a href="#add-purchase-to-contact" class="toc-h2 toc-link" data-title="Add Purchase to Contact">Add Purchase to Contact</a>
                    </li>
                </ul>
          </li>
          <li>
              <a href="#ads" class="toc-h1 toc-link" data-title="Ads">Ads</a>
                <ul class="toc-list-h2">
                    <li>
                      <a href="#record-ad-performance" class="toc-h2 toc-link" data-title="Record Ad Performance">Record Ad Performance</a>
                    </li>
                </ul>
          </li>
          <li>
              <a href="#subscriptions" class="toc-h1 toc-link" data-title="Subscriptions">Subscriptions</a>
                <ul class="toc-list-h2">
                    <li>
                      <a href="#add-subscription" class="toc-h2 toc-link" data-title="Add Subscription">Add Subscription</a>
                    </li>
                </ul>
          </li>
          <li>
              <p class="toc-section">JS API</p>
          </li>
          <li>
              <a href="#js_getting_started" class="toc-h1 toc-link" data-title="Getting Started">Getting Started</a>
                <ul class="toc-list-h2">
                    <li>
                      <a href="#installing-your-javascript-snippet" class="toc-h2 toc-link" data-title="Installing Your JavaScript Snippet">Installing Your JavaScript Snippet</a>
                    </li>
                    <li>
                      <a href="#how-to-send-a-js-api-request" class="toc-h2 toc-link" data-title="How to Send a JS API Request">How to Send a JS API Request</a>
                    </li>
                </ul>
          </li>
          <li>
              <a href="#identifying-visitors" class="toc-h1 toc-link" data-title="Identifying Visitors">Identifying Visitors</a>
                <ul class="toc-list-h2">
                    <li>
                      <a href="#connect-a-contact-to-the-current-web-session" class="toc-h2 toc-link" data-title="Connect a Contact to the Current Web Session">Connect a Contact to the Current Web Session</a>
                    </li>
                </ul>
          </li>
      </ul>
        <ul class="toc-footer">
            <li><a href='https://segmetrics.io'>Get Started at SegMetrics.io</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id='rest-section'>REST Section</h1><h1 id='getting-started'>Getting started</h1><h2 id='overview'>Overview</h2>
<p>Welcome to the SegMetrics API!</p>

<p>The SegMetrics API v1 is a way to enable customer to import their own data into their SegMetrics account, either through a custom integration,
or to modify existing information in their integrations.</p>

<p>Calls for the SegMetrics API v1 are relative to the url:
<code>https://import.segmetrics.io/api/v1/&lt;account_id&gt;/&lt;integration_id/</code></p>

<p>API v1 is in active development.</p>
<h2 id='authentication'>Authentication</h2>
<p>The SegMetrics API uses two pieces of information to authorize your account.</p>

<blockquote>
<p>Authorization</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>curl <span class="s2">"https://import.segmetrics.io/api/v1/&lt;account_id&gt;/&lt;integration_id/&lt;endpoint&gt;"</span> <span class="se">\ </span> 
  -H <span class="s1">'Authorization: YOUR_API_KEY'</span>
  -H <span class="s1">'Content-Type: application/json'</span>
</code></pre>
<ul>
<li>Your <code>Account ID</code> is appended to the URL of each request that you&#39;ll make to the API</li>
<li>Your <code>API Key</code> is sent as an authorization header on each request.</li>
</ul>

<p>You can find your <code>Account Id</code> and <code>API Key</code> in the <a href="https://app.segmetrics.io/a/account/edit">SegMetrics Account page</a>.</p>
<h2 id='responses'>Responses</h2>
<blockquote>
<p>Successful Call</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"success"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>When an API call succeeds, the API will return a 200 HTTP response and a JSON response body unless otherwise noted.</p>

<p>If there&#39;s an error, the API will return an HTTP response in the 400 or 500 range and a response body indicating what caused the error.</p>
<h3 id='bad-data'>Bad data</h3>
<p>When you create or update a field, you may receive an HTTP 400 if any fields contain bad data or required fields are missing.</p>

<blockquote>
<p>Missing Data</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"error"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"errors"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="s2">"missing 'id' field "</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre><h3 id='internal-server-errors'>Internal server errors</h3>
<p>If the server is overloaded or you encounter a bug, you will get a 500 error. 
Try again after a short period, and if you continue to encounter an error, please raise the issue with support.</p>
<h1 id='contacts'>Contacts</h1><h2 id='add-or-update-contact'>Add or Update Contact</h2>
<blockquote>
<p>Example request</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>curl -X POST https://import.segmetrics.io/api/v1/&lt;account_id&gt;/&lt;integration_id&gt;/contact
     -H <span class="s1">'Authorization: YOUR_API_KEY'</span>
     -H <span class="s1">'Content-Type: application/json'</span>
     -d <span class="s1">'{
           "contact_id": 249,
           "first_name": "Joey",
           "last_name": "Bloggs",
           "email": "joey@bloggs.com",
           "status": '</span>active<span class="s1">',
           "date_created": "2018-10-02 16:15:00",
           "last_updated": "2018-11-28 09:28:42",
           "utm_source": "facebook",
           "utm_content": "holiday special",
           "utm_medium": "facebook",
           "utm_campaign": "holiday",
           "utm_term": "awesomeness",
           "referring_url": "reallycoolurl.com",
           "optin_url": "evencoolerurl.com",
           "ip_address": "8.8.8.8",
           "affiliate_id": "123",
           "geo_lat": "45.523064",
           "geo_lon": "-122.676483",
           "tags": [
             {
               "id": 3,
               "name": "New Lead",
               "date": "2018-10-02 16:15:00"
             },
             {
               "id": 45,
               "name": "2018 Holiday Special",
               "date": "2018-11-28 09:25:33"
             },
             {
               "id": 8,
               "name": "Platinum Customer",
               "date": "2018-11-28 09:28:42"
             }
           ],
           "custom_fields": {
                "shirt_size": "Medium",
                "Awesome Sauce": "Applesauce2"
           }
         }'</span>
</code></pre>
<p>Adds a contact to the specified SegMetrics integration.</p>

<aside class="notice">
If the `contact_id` already exists, the existing contact will be updated.
</aside>
<h3 id='endpoint'>Endpoint</h3>
<p><strong>POST</strong> <code>/v1/&lt;account_id&gt;/&lt;integration_id&gt;/contact</code></p>
<h3 id='path-parameters'>Path parameters</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>account_id</code></td>
<td>Account API id available from your Account Settings Page</td>
</tr>
<tr>
<td><code>integration_id</code></td>
<td>This is the ID of the integration from your Account Settings Page</td>
</tr>
</tbody></table>
<h3 id='request-body-schema'>Request Body Schema</h3>
<p><code>application/json</code></p>
<h3 id='required-parameters'>Required parameters</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>contact_id</code></td>
<td>Contact Id (Required if no contact email)</td>
</tr>
<tr>
<td><code>email</code></td>
<td>Contact Email Address (Required if no contact_id)</td>
</tr>
</tbody></table>

<aside class="notice">
When looking for a contact to update, the API gives priority to the contact_id over email.<br/>
When passing a contact_id, if the email address already exists, that contact_id will be updated with the new id. 
</aside>
<h3 id='optional-parameters'>Optional parameters</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>date_created</code></td>
<td>Date Created</td>
</tr>
<tr>
<td><code>first_name</code></td>
<td>Contact First Name</td>
</tr>
<tr>
<td><code>last_name</code></td>
<td>Contact Last Name</td>
</tr>
<tr>
<td><code>status</code></td>
<td>Optin status of the contact. <code>active</code> or <code>inactive</code> (defaults to <code>active</code>)</td>
</tr>
<tr>
<td><code>tags</code></td>
<td>List of TagIds or Array of Tag Objects</td>
</tr>
<tr>
<td><code>custom_fields</code></td>
<td>Object containing custom field data. E.g. <code>{ &quot;shirt_size&quot;: &quot;Medium&quot; }</code>.</td>
</tr>
<tr>
<td><code>last_updated</code></td>
<td>Date Last Updated</td>
</tr>
<tr>
<td><code>utm_campaign</code></td>
<td>UTM Campaign</td>
</tr>
<tr>
<td><code>utm_content</code></td>
<td>UTM Content</td>
</tr>
<tr>
<td><code>utm_medium</code></td>
<td>UTM Medium</td>
</tr>
<tr>
<td><code>utm_source</code></td>
<td>UTM Source</td>
</tr>
<tr>
<td><code>utm_term</code></td>
<td>UTM Term</td>
</tr>
<tr>
<td><code>referring_url</code></td>
<td>Referring URL</td>
</tr>
<tr>
<td><code>optin_url</code></td>
<td>Optin URL</td>
</tr>
<tr>
<td><code>ip_address</code></td>
<td>IP Address</td>
</tr>
<tr>
<td><code>affiliate_id</code></td>
<td>Affiliate ID</td>
</tr>
<tr>
<td><code>geo_lat</code></td>
<td>Geographic Latitude</td>
</tr>
<tr>
<td><code>geo_lon</code></td>
<td>Geographic Longitude</td>
</tr>
</tbody></table>

<aside class="notice">
When updating `custom_fields`, data will be **appended** to the existing data.<br/>
When updating `tags`, data will *replace* the existing data. Use `tags/add` to add tags to a contact. 
</aside>
<h1 id='tags'>Tags</h1><h2 id='add-tags-to-contact'>Add Tags to Contact</h2>
<blockquote>
<p>Example request (Tag Ids)</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>curl -X POST https://import.segmetrics.io/api/v1/&lt;account_id&gt;/&lt;integration_id&gt;/tags/add <span class="se">\</span>
     -H <span class="s1">'Authorization: YOUR_API_KEY'</span> <span class="se">\</span>
     -H <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
     -d <span class="s1">'{
           "contact_id": 249,
           "tags": [ 3, 45, 8 ]
         }'</span>
</code></pre>
<blockquote>
<p>Example request (Tag Names)</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>curl -X POST https://import.segmetrics.io/api/v1/&lt;account_id&gt;/&lt;integration_id&gt;/tags/add <span class="se">\</span>
     -H <span class="s1">'Authorization: YOUR_API_KEY'</span> <span class="se">\</span>
     -H <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
     -d <span class="s1">'{
           "contact_id": 249,
           "tags": [
               "New Lead",
               "2018 Holiday Special",
               "Platinum Customer"
           ]
         }'</span>
</code></pre>
<blockquote>
<p>Example request (Tag Objects)</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>curl -X POST https://import.segmetrics.io/api/v1/&lt;account_id&gt;/&lt;integration_id&gt;/tags/add <span class="se">\</span>
     -H <span class="s1">'Authorization: YOUR_API_KEY'</span> <span class="se">\</span>
     -H <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
     -d <span class="s1">'{
           "contact_id": 249,
           "tags": [
             {
               "id": 3,
               "name": "New Lead",
               "date": "2018-10-02 16:15:00"
             },
             {
               "id": 45,
               "name": "2018 Holiday Special",
               "date": "2018-11-28 09:25:33"
             }
           ]
         }'</span>
</code></pre>
<p>Tags can be submitted in three different ways depending on how they&#39;re available in your application. Examples are shown to the right.</p>
<h3 id='endpoint'>Endpoint</h3>
<p><strong>POST</strong> <code>/v1/&lt;account_id&gt;/&lt;integration_id&gt;/tags/add</code></p>
<h3 id='path-parameters'>Path parameters</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>account_id</code></td>
<td>Account API id available from your Account Settings Page</td>
</tr>
<tr>
<td><code>integration_id</code></td>
<td>This is the ID of the integration from your Account Settings Page</td>
</tr>
</tbody></table>
<h3 id='request-body-schema'>Request Body Schema</h3>
<p><code>application/json</code></p>
<h3 id='required-parameters'>Required parameters</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>contact_id</code></td>
<td>Contact Id (Required if no contact email)</td>
</tr>
<tr>
<td><code>email</code></td>
<td>Contact Email Address (Required if no contact_id)</td>
</tr>
<tr>
<td><code>tags</code></td>
<td>Array of Tags.</td>
</tr>
</tbody></table>
<h3 id='tag-format'>Tag Format</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>id</code></td>
<td>Tag Id</td>
</tr>
<tr>
<td><code>name</code></td>
<td>Tag Name</td>
</tr>
<tr>
<td><code>date</code></td>
<td>DateTime the Tag was applied (defaults to now)</td>
</tr>
</tbody></table>
<h2 id='remove-tags-to-contact'>Remove Tags to Contact</h2>
<blockquote>
<p>Example request (Tag Ids)</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>curl -X POST https://import.segmetrics.io/api/v1/&lt;account_id&gt;/&lt;integration_id&gt;/tags/remove <span class="se">\</span>
     -H <span class="s1">'Authorization: YOUR_API_KEY'</span> <span class="se">\</span>
     -H <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
     -d <span class="s1">'{
           "contact_id": 249,
           "tags": [ 3, 45, 8 ]
         }'</span>
</code></pre>
<blockquote>
<p>Example request (Tag Names)</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>curl -X POST https://import.segmetrics.io/api/v1/&lt;account_id&gt;/&lt;integration_id&gt;/tags/remove <span class="se">\</span>
     -H <span class="s1">'Authorization: YOUR_API_KEY'</span> <span class="se">\</span>
     -H <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
     -d <span class="s1">'{
           "contact_id": 249,
           "tags": [
               "New Lead",
               "2018 Holiday Special",
               "Platinum Customer"
           ]
         }'</span>
</code></pre>
<blockquote>
<p>Example request (Tag Objects)</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>curl -X POST https://import.segmetrics.io/api/v1/&lt;account_id&gt;/&lt;integration_id&gt;/tags/remove <span class="se">\</span>
     -H <span class="s1">'Authorization: YOUR_API_KEY'</span> <span class="se">\</span>
     -H <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
     -d <span class="s1">'{
           "contact_id": 249,
           "tags": [
             {
               "id": 3,
               "name": "New Lead"
             },
             {
               "id": 45,
               "name": "2018 Holiday Special"
             }
           ]
         }'</span>
</code></pre>
<p>Tags can be submitted in three different ways depending on how they&#39;re available in your application. Examples are shown to the right.</p>
<h3 id='endpoint-2'>Endpoint</h3>
<p><strong>POST</strong> <code>/v1/&lt;account_id&gt;/&lt;integration_id&gt;/tags/remove</code></p>
<h3 id='path-parameters-2'>Path parameters</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>account_id</code></td>
<td>Account API id available from your Account Settings Page</td>
</tr>
<tr>
<td><code>integration_id</code></td>
<td>This is the ID of the integration from your Account Settings Page</td>
</tr>
</tbody></table>
<h3 id='request-body-schema-2'>Request Body Schema</h3>
<p><code>application/json</code></p>
<h3 id='required-parameters-2'>Required parameters</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>contact_id</code></td>
<td>Contact Id (Required if no contact email)</td>
</tr>
<tr>
<td><code>email</code></td>
<td>Contact Email Address (Required if no contact_id)</td>
</tr>
<tr>
<td><code>tags</code></td>
<td>Array of Tags.</td>
</tr>
</tbody></table>
<h3 id='tag-format-2'>Tag Format</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>id</code></td>
<td>Tag Id</td>
</tr>
<tr>
<td><code>name</code></td>
<td>Tag Name</td>
</tr>
</tbody></table>
<h1 id='orders'>Orders</h1><h2 id='add-purchase-to-contact'>Add Purchase to Contact</h2>
<blockquote>
<p>Example request</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>curl -X POST https://import.segmetrics.io/api/v1/&lt;account_id&gt;/&lt;integration_id&gt;/invoice
     -H <span class="s1">'Authorization: YOUR_API_KEY'</span>
     -H <span class="s1">'Content-Type: application/json'</span>
     -d <span class="s1">'{
           "contact_id": 4,
           "id": 234115,
           "amount": 4500,
           "paid": 4500,
           "is_refunded": 0,
           "date_created": "2018-10-03 11:14:32",
           "items": [
             {
               "name": "Round Tuit",
               "product_id": 1556402307145,
               "amount": 4000,
               "total_paid": 4000
             },
             {
               "name": "Uber Trinket",
               "product_id": 82638,
               "amount": 500,
               "total_paid": 500
             }
           ]
         }'</span>
</code></pre>
<p>Adds a purchase to the specified SegMetrics integration.</p>

<aside class="notice">
If the `id` already exists, the existing invoice will be updated.
</aside>
<h3 id='endpoint'>Endpoint</h3>
<p><strong>POST</strong> <code>/v1/&lt;account_id&gt;/&lt;integration_id&gt;/invoice</code></p>
<h3 id='path-parameters'>Path parameters</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>account_id</code></td>
<td>Account API id available from your Account Settings Page</td>
</tr>
<tr>
<td><code>integration_id</code></td>
<td>This is the ID of the integration from your Account Settings Page</td>
</tr>
</tbody></table>
<h3 id='request-body-schema'>Request Body Schema</h3>
<p><code>application/json</code></p>
<h3 id='required-parameters'>Required parameters</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>id</code></td>
<td>Invoice Id</td>
</tr>
<tr>
<td><code>contact_id</code></td>
<td>Contact Id (Required if no contact email)</td>
</tr>
<tr>
<td><code>email</code></td>
<td>Contact&#39;s Email (Required if no contact id)</td>
</tr>
<tr>
<td><code>amount</code></td>
<td>Invoice Total in Cents</td>
</tr>
<tr>
<td><code>paid</code></td>
<td>Invoice Amount Paid in Cents</td>
</tr>
<tr>
<td><code>date_created</code></td>
<td>Invoice Date</td>
</tr>
<tr>
<td><code>items</code></td>
<td>Array of Invoice Items</td>
</tr>
</tbody></table>
<h3 id='optional-parameters'>Optional parameters</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>is_refunded</code></td>
<td>Invoice Refunded Flag</td>
</tr>
</tbody></table>
<h3 id='item-parameters'>Item Parameters</h3>
<p>For each invoice, include the line items of which products were included.
If the product does not exist in SegMetrics, one will be created.</p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>name</code></td>
<td>Product Name</td>
</tr>
<tr>
<td><code>product_id</code></td>
<td>Product Id</td>
</tr>
<tr>
<td><code>amount</code></td>
<td>Product Price in Cents</td>
</tr>
</tbody></table>
<h1 id='ads'>Ads</h1><h2 id='record-ad-performance'>Record Ad Performance</h2>
<blockquote>
<p>Example request</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>curl -X POST https://import.segmetrics.io/api/v1/&lt;account_id&gt;/&lt;integration_id&gt;/ad/performance
     -H <span class="s1">'Authorization: YOUR_API_KEY'</span>
     -H <span class="s1">'Content-Type: application/json'</span>
     -d <span class="s1">'{
           "ad": 5489788855,
           "adcampaign": {             
              "id": 123456789,
              "name": "My Amazing Ad Campaign",
           },
           "adset": {             
              "id": 5678910,
              "name": "My Amazing Ad Set",
              "adcampaign": 123456789,
           },           
           "spend": 4500,
           "clicks": 7844,
           "impressions": 15487,
           "date": "2018-10-03",           
         }'</span>
</code></pre>
<p>Adds the add performance for a specific day to SegMetrics.</p>

<p>The AdPerformance endpoint allows passing the Ad Set and Ad Campaign values
in addition to the performance to allow users to skip campaign creation API calls
in order to simplify performance. </p>

<aside class="notice">
If the `ad` and `date_created` already exists, the existing ad performance will be updated.
</aside>
<h3 id='endpoint'>Endpoint</h3>
<p><strong>POST</strong> <code>/v1/&lt;account_id&gt;/&lt;integration_id&gt;/ad/performance</code></p>
<h3 id='path-parameters'>Path parameters</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>account_id</code></td>
<td>Account API id available from your Account Settings Page</td>
</tr>
<tr>
<td><code>integration_id</code></td>
<td>This is the ID of the integration from your Account Settings Page</td>
</tr>
</tbody></table>
<h3 id='request-body-schema'>Request Body Schema</h3>
<p><code>application/json</code></p>
<h3 id='required-parameters'>Required parameters</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>ad</code></td>
<td>The Id of the Ad. Alternately, an <code>ad</code> object may be passed (see below)</td>
</tr>
<tr>
<td><code>spend</code></td>
<td>Amount spent on the ad for this day in Cents</td>
</tr>
<tr>
<td><code>date</code></td>
<td>Date that the clicks, spend and impressions apply to</td>
</tr>
</tbody></table>
<h3 id='optional-parameters'>Optional parameters</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>adcampaign</code></td>
<td>The <code>adcampaign</code> object that the ad belongs to (see below)</td>
</tr>
<tr>
<td><code>adset</code></td>
<td>The <code>adset</code> object that the ad belongs to (see below)</td>
</tr>
<tr>
<td><code>clicks</code></td>
<td>Number of clicks on the ad for this day</td>
</tr>
<tr>
<td><code>impressions</code></td>
<td>Number of impressions on the ad for this day</td>
</tr>
</tbody></table>
<h3 id='ad-object-required-parameters'>Ad Object Required Parameters</h3>
<p><code>ad</code> may be passed as either an existing ID or an object.
 If an object is passed, then the <code>ad</code> will be created in SegMetrics, similar to if the <strong>Create Ad</strong> 
 endpoint was being called, with the following values:</p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>id</code></td>
<td>Id of the Ad</td>
</tr>
<tr>
<td><code>name</code></td>
<td>Name of the Ad</td>
</tr>
<tr>
<td><code>adcampaign</code></td>
<td>Ad Campaign Id of the Ad</td>
</tr>
<tr>
<td><code>adset</code></td>
<td>Ad Set Id of the Ad</td>
</tr>
</tbody></table>
<h3 id='adset-object-required-parameters'>AdSet Object Required Parameters</h3>
<p><code>adset</code> may be passed as either an existing ID or an object.
 If an object is passed, then the <code>AdSet</code> will be created in SegMetrics, similar to if the <strong>Create AdSet</strong> 
 endpoint was being called, with the following values:</p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>id</code></td>
<td>Id of the AdSet</td>
</tr>
<tr>
<td><code>name</code></td>
<td>Name of the AdSet</td>
</tr>
<tr>
<td><code>adcampaign</code></td>
<td>Ad Campaign Id of the AdSet</td>
</tr>
</tbody></table>
<h3 id='adcampaign-object-required-parameters'>AdCampaign Object Required Parameters</h3>
<p><code>adcampaign</code> may be passed as either an existing ID or an object.
 If an object is passed, then the <code>Campaign</code> will be created in SegMetrics, similar to if the <strong>Create AdCampaign</strong> 
 endpoint was being called, with the following values:</p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>id</code></td>
<td>Id of the Ad Campaign</td>
</tr>
<tr>
<td><code>name</code></td>
<td>Name of the Ad Campaign</td>
</tr>
</tbody></table>
<h1 id='subscriptions'>Subscriptions</h1><h2 id='add-subscription'>Add Subscription</h2>
<blockquote>
<p>Example request</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>curl -X POST https://import.segmetrics.io/api/v1/&lt;account_id&gt;/&lt;integration_id&gt;/subscription
     -H <span class="s1">'Authorization: YOUR_API_KEY'</span>
     -H <span class="s1">'Content-Type: application/json'</span>
     -d <span class="s1">'{
           "email": "mwiegand@gmail.com",
           "id": 234115,
           "amount": 4500,
           "product_id": 108,
           "start_date": "2019-12-03 11:14:32",
           "last_bill_date": "2019-12-03 11:14:32",
           "billing_cycle": "month",
           "frequency": 1
         }'</span>
</code></pre>
<p>Adds a subscription to the existing contact. If the subscription id already exist, it will be updated.
<aside class="warning">
Adding a subscription <strong>does not</strong> create a corresponding order. That must be done separately.
</aside></p>
<h3 id='endpoint'>Endpoint</h3>
<p><strong>POST</strong> <code>/v1/&lt;account_id&gt;/&lt;integration_id&gt;/subscription</code></p>
<h3 id='path-parameters'>Path parameters</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>account_id</code></td>
<td>Account API id available from your Account Settings Page</td>
</tr>
<tr>
<td><code>integration_id</code></td>
<td>This is the ID of the integration from your Account Settings Page</td>
</tr>
</tbody></table>
<h3 id='request-body-schema'>Request Body Schema</h3>
<p><code>application/json</code></p>
<h3 id='required-parameters'>Required parameters</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>id</code></td>
<td>Subscription Id</td>
</tr>
<tr>
<td><code>contact_id</code></td>
<td>Contact Id (Required if no contact email)</td>
</tr>
<tr>
<td><code>email</code></td>
<td>Contact&#39;s Email (Required if no contact id)</td>
</tr>
<tr>
<td><code>amount</code></td>
<td>Subscription Total in Cents</td>
</tr>
<tr>
<td><code>product_id</code></td>
<td>Product Id that the Subscription applies to</td>
</tr>
<tr>
<td><code>start_date</code></td>
<td>DateTime that the Subscription started</td>
</tr>
<tr>
<td><code>last_bill_date</code></td>
<td>DateTime that the Subscription was last billed</td>
</tr>
<tr>
<td><code>billing_cycle</code></td>
<td>One of <code>year</code>, <code>month</code>, <code>week</code> or <code>day</code> The frequency with which a subscription should be billed.</td>
</tr>
<tr>
<td><code>frequency</code></td>
<td>The number of intervals (specified in the <code>billing_cycle</code> property) between subscription billings. For example, <code>billing_cycle=month</code> and <code>frequency=3</code> bills every 3 months.</td>
</tr>
</tbody></table>
<h3 id='optional-parameters'>Optional parameters</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>quantity</code></td>
<td>The quantity of the plan to which the customer is subscribed. Defaults to 1</td>
</tr>
<tr>
<td><code>trial_end_date</code></td>
<td>If the subscription has a trial, the end of that trial.</td>
</tr>
<tr>
<td><code>end_date</code></td>
<td>A date in the future at which the subscription will automatically get canceled</td>
</tr>
<tr>
<td><code>canceled_date</code></td>
<td>If the subscription has been canceled, the date of that cancellation.</td>
</tr>
</tbody></table>
<h1 id='js-section'>JS Section</h1><h1 id="js_getting_started">Getting Started</h1>

<p>The SegMetrics tracking snippet has a number of API methods for performing tasks right from your website,
such as identifying contacts and tracking page views.
This document details everything you can do via our JavaScript API.</p>
<h2 id='installing-your-javascript-snippet'>Installing Your JavaScript Snippet</h2>
<blockquote>
<p>The snippet for your site generally looks something like this:</p>
</blockquote>
<pre class="highlight html tab-html"><code><span class="c">&lt;!-- SegMetrics  --&gt;</span>
<span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;</span>
  <span class="kd">var</span> <span class="nx">_segq</span> <span class="o">=</span> <span class="nx">_segq</span> <span class="o">||</span> <span class="p">[];</span>
  <span class="kd">var</span> <span class="nx">_segs</span> <span class="o">=</span> <span class="nx">_segs</span> <span class="o">||</span> <span class="p">{};</span>
  <span class="nx">_segs</span><span class="p">.</span><span class="nx">integration</span> <span class="o">=</span> <span class="s2">`your account id`</span><span class="p">;</span>

  <span class="p">(</span><span class="kd">function</span><span class="p">(){</span><span class="kd">var</span> <span class="nx">dc</span><span class="o">=</span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">'script'</span><span class="p">);</span>
    <span class="nx">dc</span><span class="p">.</span><span class="nx">type</span><span class="o">=</span><span class="s1">'text/javascript'</span><span class="p">;</span><span class="nx">dc</span><span class="p">.</span><span class="nx">async</span><span class="o">=</span><span class="kc">true</span><span class="p">;</span>
    <span class="nx">dc</span><span class="p">.</span><span class="nx">src</span><span class="o">=</span><span class="s1">'//tag.segmetrics.io/seg.js'</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">s</span><span class="o">=</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">'script'</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
    <span class="nx">s</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">dc</span><span class="p">,</span><span class="nx">s</span><span class="p">);})();</span>
<span class="nt">&lt;/script&gt;</span>
<span class="c">&lt;!-- end SegMetrics  --&gt;</span>
</code></pre>
<p>To interact with the JavaScript API, you&#39;ll need to have your SegMetrics snippet installed on your website. 
Each SegMetrics account has a unique snippet that can be found under <a href="https://app.segmetrics.io/a/settings/snippet">Settings â†’ Site Setup</a>.</p>
<h2 id='how-to-send-a-js-api-request'>How to Send a JS API Request</h2><pre class="highlight javascript tab-javascript"><code><span class="nx">_segq</span><span class="p">.</span><span class="nx">push</span><span class="p">([</span><span class="s2">"methodName"</span><span class="p">,</span> <span class="p">{</span> <span class="na">key</span><span class="p">:</span> <span class="s2">"value"</span><span class="p">,</span> <span class="p">...</span> <span class="p">}]);</span>
</code></pre>
<p>All requests follow the same conventions. If you&#39;ve ever worked with the Google Analytics API, the code should look familiar. This is the basis structure of an API request.</p>

<p>API requests are executed asynchronously, so you may safely place then anywhere on the page (even above the SegMetrics snippet).</p>
<h1 id='identifying-visitors'>Identifying Visitors</h1><h2 id='connect-a-contact-to-the-current-web-session'>Connect a Contact to the Current Web Session</h2>
<blockquote>
<p>Example identify request</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="nx">_segq</span><span class="p">.</span><span class="nx">push</span><span class="p">([</span><span class="s2">"identify"</span><span class="p">,</span> <span class="s2">"john@example.com"</span><span class="p">]);</span>
</code></pre>
<p>The <code>identify</code> command lets you tie a contact in your email marketing platform to their actions on the website. 
It includes an email address, and automatically connects to the current session.</p>

<aside class="notice">
In most cases SegMetrics will automatically identify a contact when they enter their email address on your optin forms,
or when they follow a link from an email.

You will only need to use the identify command if the marketing pages you are using are preventing SegMetrics from
automatically identifying the user.  
</aside>
<h3 id='tracking-without-the-javascript-api'>Tracking Without the JavaScript API</h3>
<blockquote>
<p>Manually Identifying a User</p>
</blockquote>
<pre class="highlight shell tab-shell"><code>curl -X GET -G https://track.segmetrics.io/identify     
     -d <span class="nv">account_id</span><span class="o">=</span>YOUR_ACCOUNT_ID
     -d <span class="nv">seg_uid</span><span class="o">=</span>SESSION_UID
     -d <span class="nv">email</span><span class="o">=</span>john@example.com     
</code></pre>
<p>In some cases you may want to manually identify a contact when you don&#39;t have access to the JavaScript API,
either through a webhook or backend system like Zapier.</p>

<p>In that case, you can make a standard HTTP request with the same information to connect a Session UID to a contact. </p>

<p>The Session UID is always available in <code>_segs.data.uid</code></p>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="shell">cURL</a>
          </div>
      </div>
    </div>
  </body>
</html>
